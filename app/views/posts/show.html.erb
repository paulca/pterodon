<article class="post">
  <header>
    <span>@<%= @post.user.username %></span>
    <small><%= @post.created_at.to_formatted_s(:clean) %></small>
  </header>
  <main>
    <%= markdown @post.content %>
  </main>

  <% if authenticated? && @post.user == Current.user %>
    <footer class="post-actions">
      <%= link_to "Edit", edit_post_path(@post) %>
      <%= button_to "Delete", @post, method: :delete, class: "link danger-text", data: {turbo_confirm: "Are you sure?"} %>
    </footer>
  <% end %>
</article>

<% replies = @post.remote_replies.order(published_at: :asc) %>
<% if replies.any? %>
  <section class="replies">
    <h3><%= pluralize(replies.size, "reply") %></h3>
    <% replies.each do |reply| %>
      <article class="reply">
        <header>
          <strong><%= reply.actor_name || reply.actor_uri %></strong>
          <small><%= reply.published_at&.to_formatted_s(:clean) %></small>
        </header>
        <main>
          <%= sanitize reply.content, tags: RemoteReply::ALLOWED_TAGS, attributes: RemoteReply::ALLOWED_ATTRIBUTES %>
        </main>
      </article>
    <% end %>
  </section>
<% end %>
